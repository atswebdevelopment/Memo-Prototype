var appData={store:window.localStorage,init:function(){appData.get=global.models.getDigest},getItem:function(a){return appData.store.getItem(a)},setWelcomeStatus:function(a){appData.store.setItem("welcomeStatus",a)},setUserEmail:function(a){appData.store.setItem("userEmail",a)},setUserName:function(a){appData.store.setItem("userName",a)},setUserKey:function(a){appData.store.setItem("userKey",a)},setUserApiUrl:function(a){appData.store.setItem("userApiUrl",a)},setReturnUser:function(){},setFingerprintCredentials:function(a){appData.store.setItem("userFPToken",a.token)}},fingerprint={clientId:"Memo",init:function(){$("form.userPin legend").html("Fingerprint init..."),$("body").on("change",".fingerprint-auth input",function(){$("form.userPin legend").html("Fingerprint change..."),"on"===$(this).val()&&($("form.userPin legend").html("Fingerprint change..."),"Android"===global.device?FingerprintAuth.isAvailable(fingerprint.isAvailableSuccess,fingerprint.isAvailableError):($("form.userPin legend").html("Fingerprint iOS..."),window.plugins.touchid.isAvailable(function(a){$("form.userPin legend").html("Fingerprint Available...")},function(a){$("form.userPin legend").html(a)})))})},onDeviceReady:function(){if(console.log("fingerprint popup start"),"Android"===global.device){if(void 0!==appData.store.getItem("userFPToken")){var a={clientId:fingerprint.clientId,username:appData.store.getItem("userEmail"),token:appData.store.getItem("userFPToken")};FingerprintAuth.decrypt(a,fingerprint.decryptSuccessCallback,fingerprint.decryptErrorCallback)}}else void 0!==appData.store.getItem("iOSTempKey")&&window.plugins.touchid.verifyFingerprint("Scan your fingerprint please",fingerprint.decryptSuccessCallback,fingerprint.decryptErrorCallback)},isAvailableSuccess:function(a){if($("form.userPin legend").html("Fingerprint available..."),"Android"===global.device){if(a.isAvailable){var b=($(this).parents("form"),{clientId:fingerprint.clientId,username:$(".getUserEmailField").val(),password:$(".getUserPasswordField").val()});FingerprintAuth.encrypt(b,fingerprint.encryptSuccessCallback,fingerprint.encryptErrorCallback)}}else $("form.userPin legend").html("Fingerprint available iOS..."),window.plugins.touchid.verifyFingerprint("Scan your fingerprint please",fingerprint.encryptSuccessCallback,fingerprint.encryptErrorCallback)},isAvailableError:function(a){$("form.userPin legend").html("Fingerprint unavailable..."),console.log("isAvailableError(): "+a)},encryptSuccessCallback:function(a){"Android"===global.device?a.withFingerprint?(console.log("Successfully encrypted credentials."),appData.setFingerprintCredentials(a)):a.withBackup&&console.log("Authenticated with backup password"):(console.log(a),appData.store.setItem("iOSTempKey","yes"))},encryptErrorCallback:function(a){a===FingerprintAuth.ERRORS.FINGERPRINT_CANCELLED?console.log("FingerprintAuth Dialog Cancelled!"):console.log("FingerprintAuth Error: "+a)},decryptSuccessCallback:function(a){"Android"===global.device?a.withFingerprint?(console.log("Successful biometric authentication."),a.password&&(console.log("Successfully decrypted credential token."),document.location.replace("dashboard.html"))):a.withBackup&&(console.log("Authenticated with backup password"),document.location.replace("dashboard.html")):document.location.replace("dashboard.html")},decryptErrorCallback:function(a){a===FingerprintAuth.ERRORS.FINGERPRINT_CANCELLED?console.log("FingerprintAuth Dialog Cancelled!"):console.log("FingerprintAuth Error: "+a)}},forms={init:function(){$(".select select").bind("change",function(){$(this).prev().text($(this).find("option:selected").text()),""===$(this).val()?$(this).parent().removeClass("active"):$(this).parent().addClass("active")}),$(".radio input").bind("change",function(){$(this).parents(".form__field").find(".radio__input").removeClass("radio__input--on"),$(this).parent().addClass("radio__input--on")}),$("input[type=checkbox]").bind("change",function(){$(this).parent().toggleClass("active")}),$("body").on("click",".controls .arrow",function(){if($(this).hasClass("controls__arrow--inactive"))return!1;var a=$(this).parents(".controls"),b=a.prev(),c=a.find(".controls__pip--active").index();if($(this).hasClass("controls__arrow--left"))$("fieldset.active").removeClass("active").prev().addClass("active"),a.find(".controls__arrow--right").removeClass("controls__arrow--inactive"),--c<=0&&(c=0,a.find(".controls__arrow--left").addClass("controls__arrow--inactive"));else{if(console.log(c>=b.find("fieldset").length-1),console.log(c+" "+(b.find("fieldset").length-1)),c>=b.find("fieldset").length-1)return b.submit(),!1;if(!forms.validateForms($("fieldset.active")))return!1;$("fieldset.active").removeClass("active").next().addClass("active"),a.find(".controls__arrow--left").removeClass("controls__arrow--inactive"),c++}return a.find(".controls__pip--active").removeClass("controls__pip--active"),a.find(".controls__pip").eq(c).addClass("controls__pip--active"),b.css("left","-"+100*c+"%"),!1}),$(".ajax").submit(function(a){var b=$(this),c=new FormData(b[0]);if(b.hasClass("no-submit"))return a.preventDefault(),!1;if(!forms.validateForms(b))return a.preventDefault(),!1;b.find(".error-text").hide(),b.addClass("form--loading");try{var d=b.serializeObject(),e="data";if(b.hasClass("headers")&&(e="headers"),b.hasClass("formAuth")){var f=global.models.postForm;"true"===b.attr("data-file")&&(d=c,f=global.models.postFile),f(b.attr("data-action"),b.attr("data-method"),d,e).success(function(a){console.log(a),forms.controller(a,b)}).fail(function(a){console.log(a),b.find(".error-text").show(),b.removeClass("form--loading")})}else{(0,global.models.putDigest)(b.attr("data-action"),b.attr("data-method"),d).done(function(a){forms.controller(a,b)}).fail(function(a){console.log("n"),b.find(".error-text").show(),b.removeClass("form--loading")})}}catch(a){console.log(a),console.log("form post failed"),b.find(".error-text").show(),b.removeClass("form--loading")}a.preventDefault()}),$("body").on("change",".form__field input, .form__field select",function(){var a=$(this).parents(".form__field");forms.validateForms(a)}).on("keyup",".form__field--pin input",function(){$(this).next().focus()})},controller:function(a,b){var c=b.prev().find("p");if(b.removeClass("form--loading"),"SUCCESS"!==a.status)return console.log(a.status),c.html(a.status),!1;if(b.addClass("form--complete"),b.hasClass("authenticate")&&(appData.setWelcomeStatus("loggedin"),appData.setUserEmail(b.find(".getUserEmailField").val()),appData.setUserName(a.user.email),appData.setUserKey(a.user.digest_hash),appData.setUserApiUrl("users/"+a.user.id+".json"),document.location.replace("dashboard.html")),b.hasClass("userRegister")){$(".register--active").removeClass("register--active").next().addClass("register--active").find("fieldset").eq(0).addClass("active"),$(".setUserEmailField").val($(".getUserEmailField").val()),appData.setUserEmail(b.find(".getUserEmailField").val()),appData.setUserName(a.user.email),appData.setUserKey(a.user.digest_hash);var d="users/"+a.user.id+".json";appData.setUserApiUrl("users/"+a.user.id+".json"),$("form.userPin").attr("data-action",d)}b.hasClass("userPin")&&document.location.replace("dashboard.html")},validateForms:function(a){var b=!0;return a.find(".required").each(function(){if($(this).is("div")){var a=0;$(this).find("input,select").each(function(){""===$(this).val()&&(b=!1,$(this).parents(".form__field").addClass("form__field--error").find(".form__validation").text("This field is required"),a++)}),0===a&&$(this).parents(".form__field").addClass("form__field--valid").removeClass("form__field--error").find(".form__validation").text("")}else"radio"===$(this).attr("type")?$(this).is(":checked")||(b=!1,$(this).parents(".form__field").addClass("form__field--error").find(".form__validation").text("This field is required")):""===$(this).val()?(b=!1,$(this).parents(".form__field").addClass("form__field--error").find(".form__validation").text("This field is required")):$(this).parents(".form__field").addClass("form__field--valid").removeClass("form__field--error").find(".form__validation").text("")}),a.find(".email").each(function(){""!==$(this).val()&&(!1===forms.validateEmail($(this).val())?(b=!1,$(this).parents(".form__field").addClass("form__field--error").find(".form__validation").text("Email address is not valid")):$(this).parents(".form__field").addClass("form__field--valid").removeClass("form__field--error").find(".form__validation").text(""))}),a.find(".phone").each(function(){""!==$(this).val()&&(!1===forms.validatePhone($(this).val())?(b=!1,$(this).parents(".form__field").addClass("form__field--error").find(".form__validation").text("Telephone number is not valid")):$(this).parents(".form__field").addClass("form__field--valid").removeClass("form__field--error").find("..form__validation").text(""))}),a.find(".form__field--error").eq(0).find("input,select").eq(0).focus(),b},validateEmail:function(a){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)},validatePhone:function(a){return/^[0-9]+$/.test(a)}};!function(a,b){"$:nomunge";a.fn.serializeObject=function(){var b={};return a.each(this.serializeArray(),function(c,d){var e=d.name,f=d.value;b[e]=void 0===b[e]?f:a.isArray(b[e])?b[e].concat(f):[b[e],f]}),b}}(jQuery);var global={api_key:"YTdqEC}p`H&GfnST{tGD#g7h?%mZ`[",api_endpoint:"http://lifesbackup.com/api/",init:function(){global.ux(),global.ui(),global.resize(),global.setImages()},ux:function(){$(".form--slide").each(function(){var a=$(this).find("fieldset").length;$(this).css("width",100*a+"%"),$(this).find("fieldset").show().css("width",100/a+"%")}),$(document).ready(function(){var a=0;$(".boxes__progress-value").each(function(){$(this).css("stroke-dashoffset",a),a+=40})}),$(".gallery").length&&$(".gallery").slick(global.views.slickSettings)},ui:function(){document.addEventListener("deviceready",global.onDeviceReady.bind(this),!1),$("body").on("click",".arrow a",function(){if(!$(this).parents(".slick-initialized").length){var a=$(this).parents(".section").next();$("html, body").stop().animate({scrollTop:a.offset().top+parseInt(a.attr("data-offset"))},300)}return!1}).on("click",".toggle-content a",function(){return $(this).find("span").toggleClass("hidden"),$(this).parent().prev().toggle(300),!1}).on("click",".nav a",function(){var a=$(this).attr("href");return $("html, body").stop().animate({scrollTop:$(a).offset().top},0),!1}),$(".help").click(function(){return $("body").append('<div class="popup"> <a class="close" href="#"><span class="svg-load" data-src="images/icon-plus.svg"></span></a><div class="popup__content vertical-block"> <div class="logo logo--small logo--help"><span class="svg-load" data-src="images/icon-help.svg"></span></div><span class="title">need a little help?</span><p>Perhaps this quick video will do the trick?<br/><br/></p><p><span class="button button--alt"><a href="">watch the video</a></span></p><p>Or failing that, please tell us about your problem here:</p><form class="form ajax" data-method="PostLogin" novalidate> <fieldset class="active"> <div class="form__field"> <input type="text" name="help" id="help" class="required" placeholder="how can we help?"/> </div></fieldset> </form> <h2>FAQs</h2> <ul class="faqs"> <li class="faqs__item"> <a class="faqs__link" href=""></a> <div class="inner"> <span class="svg-load faqs__edit" data-src="images/icon-arrow-small.svg"></span> <span class="faqs__title">Mortgage Statements</span> </div></li><li class="faqs__item"> <a class="faqs__link" href=""></a> <div class="inner"> <span class="svg-load faqs__edit" data-src="images/icon-arrow-small.svg"></span> <span class="faqs__title">Parking Permit</span> </div></li><li class="faqs__item"> <a class="faqs__link" href=""></a> <div class="inner"> <span class="svg-load faqs__edit" data-src="images/icon-arrow-small.svg"></span> <span class="faqs__title">My CV</span> </div></li><li class="faqs__item"> <a class="faqs__link" href=""></a> <div class="inner"> <span class="svg-load faqs__edit" data-src="images/icon-arrow-small.svg"></span> <span class="faqs__title">House insurance</span> </div></li></ul> </div></div>'),global.setImages(),!1}),$("a").click(function(){if(""===$(this).attr("href"))return $("body").append('<div class="popup"><a class="close" href="#"><span class="svg-load" data-src="images/icon-plus.svg"></span></a><div class="popup__content vertical-block"><span class="title">Coming soon</span><span class="img-load" data-src="images/image-coming-soon.svg"></span><p>We\'re currently making some improvements. We promise we wont keep you waiting too long!</p></div><span class="svg-load cloud cloud--98" data-src="images/icon-cloud.svg"></span><span class="svg-load cloud cloud--99" data-src="images/icon-cloud.svg"></span></div>'),global.setImages(),!1}),$(".memoViewFileImage").click(function(){return $("body").append('<div class="popup"><a class="close" href="#"><span class="svg-load" data-src="images/icon-plus.svg"></span></a><div class="popup__image"><img src="'+$(".memoViewFileImage img").attr("src")+'" /></div></div>'),global.setImages(),!1}),$(".highlight__item").click(function(){$(".highlight__item").removeClass("highlight__item--active"),$(this).addClass("highlight__item--active")}),$("body").on("change",".form__field--selection input",function(){var a=$(this).parents(".form__field"),b=a.find("input:checked").val();"upload"===b?window.location.href="add-upload.html":"details"===b&&(window.location.href="add-details.html")}).on("click",".upload__button-done a",function(){window.location.href="vehicles.html"}),$("body").on("click",".close",function(){return $(".popup").remove(),!1})},onDeviceReady:function(){global.device=device.platform,console.log(global.device+" device ready")},setImages:function(){$(".img-load,.bg-load,.svg-load").each(function(){var a=!!$(this).hasClass("bg-load"),b=$(this).attr("class"),c=$(this).attr("data-src"),d=$(this).attr("data-mob");$(this).removeClass("img-load bg-load svg-load");var e=$(this).attr("class");if(!($(window).width()<768&&"no"===d)&&void 0!==c){if(c.indexOf("[width]")>-1){var f=1600;$(window).width()<1024&&(f=1024),$(window).width()<768&&(f=768),$(this).attr("data-src",c.replace("[width]",f)),$(window).width()<768&&void 0!==$(this).attr("data-src-mob")&&$(this).attr("data-src",$(this).attr("data-src-mob"))}if(a){var g=$(this);$("<img/>").attr("src",g.attr("data-src")).on("load",function(){$(this).remove(),g.css("background-image","url("+g.attr("data-src")+")")})}else if(b.indexOf("svg-load")>-1){var h=$(this),i=(h.attr("id"),h.attr("data-src"));$.get(i,function(a){var b=$(a).find("svg");b=b.attr("class",e),b=b.attr("data-src",i),b=b.removeAttr("xmlns:a"),!b.attr("viewBox")&&b.attr("height")&&b.attr("width")&&b.attr("viewBox","0 0 "+b.attr("height")+" "+b.attr("width")),h.replaceWith(b)},"xml")}else $(this).replaceWith('<img class="'+e+'" src="'+$(this).attr("data-src")+'" alt="'+$(this).attr("data-alt")+'">')}})},resize:function(){},getParameterByName:function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},views:{slickSettings:{dots:!0,arrows:!1}},models:{getData:function(a,b){return $.ajax({url:"http://memo.jabberwokie.com/umbraco/api/MemoAppApi/"+a+b,type:"GET"})},postForm:function(a,b,c,d){var e={url:global.api_endpoint+a,type:b,context:document.body},f={"X-Api-Key":global.api_key};return"headers"===d?f=$.extend(f,c):e=$.extend(e,{data:c}),e=$.extend(e,{headers:f}),$.ajax(e)},postFile:function(a,b){return $.ajax({url:"http://memo.jabberwokie.com/umbraco/api/MemoAppApi/"+b,type:"POST",processData:!1,contentType:!1,context:document.body,data:a})},getDigest:function(a,b){var c=global.api_endpoint+a;return void 0!==b&&null!==b&&(c+=b),$.getDigest(c,{headers:{"x-api-key":global.api_key}},appData.getItem("userName"),appData.getItem("userKey"))},putDigest:function(a,b,c){return $.putDigest(global.api_endpoint+a,{data:c,headers:{"x-api-key":global.api_key}},appData.getItem("userName"),appData.getItem("userKey"))}}},pages={init:function(){$(".welcome").length&&pages.welcome(),$(".dashboard").length&&pages.dashboard(),$(".add-details").length&&pages.addDetails(),$(".view-file").length&&pages.viewFile()},welcome:function(){var a="welcome to memo";appData.store.getItem("userName")&&(a="hello "+appData.store.getItem("userName")),$(".memoWelcomeTitle").html(a)},dashboard:function(){appData.get(appData.getItem("userApiUrl"),null).success(function(a){appData.setUserName(a);var b="welcome to memo";appData.store.getItem("userName")&&(b="Hi "+appData.store.getItem("userName")),$(".memoDashboardHello").html(b)})},addDetails:function(){appData.get("GetUserFiles","?email="+appData.store.getItem("userEmail")).success(function(a){function b(a,b){if(0===a)return"0 Bytes";var c=b||2,d=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],e=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,e)).toFixed(c))+" "+d[e]}var c=JSON.parse(a),d="";$.each(c,function(a,c){var e=c.file.split("."),f=0;void 0!==c.fileSize&&(f=b(c.fileSize,1)),d+='<div class="file-list__item"><a href="view-file.html?file='+c.file+"&name="+c.tag+'" class="file-list__link"></a><div class="inner"><span class="file-list__icon img-load" data-src="images/icon-folder.svg"></span><span class="file-list__title">'+c.tag+'</span><span class="file-list__subtitle">'+e[e.length-1].toUpperCase()+" - "+f+"</span></div></div>"}),$(".file-list").append(d),global.setImages()})},viewFile:function(){var a=global.getParameterByName("file"),b=global.getParameterByName("name");$(".memoViewFileName").html(b),$(".memoViewFileImage").html('<img id="imgfile" src="http://memo.jabberwokie.com/userUploads/'+a+'"/>')}},splash={init:function(){if(appData.store.getItem("welcomeStatus"))"loggedin"===appData.store.getItem("welcomeStatus")?($(".login").show(),document.addEventListener("deviceready",fingerprint.onDeviceReady.bind(this),!1)):$(".get-started").show();else{$(".splash").show();var a=0,b=setInterval(function(){$(".splash__stage").eq(a+1).length?($(".splash__stage").eq(a).removeClass("splash__stage--active"),a++,$(".splash__stage").eq(a).addClass("splash__stage--active")):(clearInterval(b),$(".splash__stage").eq(a).removeClass("splash__stage--active"),setTimeout(function(){$(".splash").hide(),$(".get-started").show()},1e3))},3e3);appData.setWelcomeStatus("on")}$(".login-toggle").click(function(){return $(".login").show(),$(".get-started").hide(),console.log("fingerprint waiting for device ready"),!1}),$(".register-toggle").click(function(){return $(".login").hide(),$(".get-started").show(),!1})}},uploadFile={storedFile:null,init:function(){$(".upload__link a").click(function(){return uploadFile.openCamera($(this).attr("class")),!1}),$(".upload__button-confirm").click(function(){return $(".upload__stage").hide(),$(".upload__stage--stage-3").show(),!1}),$(".upload__button-save").click(function(){return $(this).hide(),null!==uploadFile.storedFile?uploadFile.upload(uploadFile.storedFile):(console.log("debug upload"),uploadFile.uploadSuccess()),!1}),$(".upload__button-refresh").click(function(){return document.location.replace("add-upload.html"),!1}),$(".upload__button-done").click(function(){return document.location.replace("add-details.html"),!1})},openCamera:function(a){try{var b="upload__link-camera"===a?Camera.PictureSourceType.CAMERA:Camera.PictureSourceType.PHOTOLIBRARY,c=uploadFile.setOptions(b);navigator.camera.getPicture(function(a){uploadFile.displayImage(a),uploadFile.getFileEntry(a)},function(a){console.debug("Unable to obtain picture: "+a,"app"),console.log(a)},c)}catch(a){uploadFile.uploadTemp()}},displayImage:function(a){$(".upload__inner img").remove(),$(".upload__inner").append('<img src="'+a+'"/>'),$(".upload__stage").hide(),$(".upload__stage--stage-2").show()},setOptions:function(a){return{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:a,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,allowEdit:!0,correctOrientation:!0}},getFileEntry:function(a){window.resolveLocalFileSystemURL(a,function(a){try{console.log("got file: "+a.fullPath),uploadFile.storedFile=a}catch(a){console.log(a)}},function(){uploadFile.createNewFileEntry()})},createNewFileEntry:function(){window.resolveLocalFileSystemURL(cordova.file.cacheDirectory,function(a){a.getFile("null",{create:!0,exclusive:!1},function(a){try{console.log("got file: "+a.fullPath),uploadFile.storedFile=a}catch(a){console.log(a)}},uploadFile.onErrorCreateFile)},uploadFile.onErrorResolveUrl)},onErrorCreateFile:function(a){console.log(a)},onErrorResolveUrl:function(a){console.log(a)},upload:function(a){console.log(a),$(".upload").addClass("upload--image-uploading");var b=a.toURL(),c=new FileUploadOptions;c.fileKey="file",c.fileName=b.substr(b.lastIndexOf("/")+1),c.mimeType="text/plain";var d={};d.customName=$(".customName").val(),d.userEmail=appData.store.getItem("userEmail"),c.params=d,(new FileTransfer).upload(b,encodeURI("http://memo.jabberwokie.com/umbraco/api/MemoAppApi/UploadFile"),uploadFile.uploadSuccess,uploadFile.uploadFail,c)},uploadTemp:function(){$(".upload__inner img").remove(),$(".upload__inner").append('<img src="/images/image-document.jpg"/>'),$(".upload__stage").hide(),$(".upload__stage--stage-2").show()},uploadSuccess:function(){console.log("SUCCESSFUL UPLOAD!"),console.log($(".customName").val()),console.log(appData.store.getItem("userEmail")),$(".upload__button-save").show(),$(".upload__stage").hide(),$(".upload__stage--stage-4").show()},uploadFail:function(a){alert("An error has occurred: Code = "+a.code),$(".upload__button-save").show()}};global.init(),appData.init(),pages.init(),$(".form").length&&(forms.init(),fingerprint.init()),$(".upload").length&&uploadFile.init(),$(".splash").length&&splash.init();